<!DOCTYPE html>
<!--Ovo je CSS Tutorial 2-->
<html>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<head>
<title>Ajax</title> <!--ovo je naziv taba-->
<!--To use multiple Google fonts, just separate the font names with a pipe character (|), like this:-->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Audiowide|Sofia|Trirong">
<link rel="stylesheet" href="assests/css/styles.css">
<link rel="stylesheet" href = "assests/css/styles2.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"/>
<link rel="stylesheet" href="assets/css/spapp.css" />
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic"
  rel="stylesheet" type="text/css" />
<link href="assets/css/freelancer.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css" />     
<link href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.css" rel="stylesheet">
<!--Use the CSS property float:left to display a list horizontally-->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script> <!--ovo je da dowloadujemo jquery biblioteku-->
<script src="assests/js/initial.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script
  type="text/javascript"
  src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"
></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.js"></script>
<script src="assets/js/jquery.spapp.js"></script>
<script src="assets/js/custom.js"></script>
<script src="assets/js/intro.js"></script>
<script src="config.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
<style>
  table tr, td{
    border: 1px solid black
  }
</style>
</head>
<body>


  <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand" href="#page-top">Start Bootstrap</a>
      <button class="navbar-toggler navbar-toggler-right text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto" id="tabs"></ul>
      </div>
    </div>
  </nav>
  <!--ovo main ce biti ta pocena stranica, jako je bitno da imamo id u svakom ovo sectionu!! -->
  <main id="spapp" role="main">
      <!--<section id="students"></section>
      <section id="highcharts"></section>
      <section id="datatable"><h1>Datatable</h1></section>
      <section id="ex1"><h1>Example 1</h1></section>
      <section id="ex2"><h1>Example 2</h1></section>
      <section id="form"><h1>Form</h1></section>-->
  </main>

<br/><br/><br/>
<select class="js-example-data-array" name="state" style="width:100%" onchange="printValue()">
</select><br/>


<button type="button" onclick="display('Primary')" class="btn btn-primary">Primary</button>
<button type="button" onclick="display('Secondary')" class="btn btn-secondary">Secondary</button>
<button type="button" onclick="greeting('Success')" class="btn btn-success">Success</button>
<button type="button" onclick="greeting('Danger')" class="btn btn-danger">Danger</button>
<button type="button" class="btn btn-warning">Warning</button>
<button type="button" class="btn btn-info">Info</button>
<button type="button" class="btn btn-light">Light</button>
<button type="button" class="btn btn-dark">Dark</button>
<br/><br/><br/>

<!-- Modal -->
<div class="modal" id = "deleteStudentModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div> 
      <input id = "student_id" name = "student_id" hidden/> <!--filed wil exist but it will not be displayed to the user-->
      <div class="modal-body" id = "delete-student-body">
       
        <p>Modal body text goes here.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" onClick="deleteStudent()" >Delete Student</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


  
</nav>

<script>

var nav =
  '<li class="nav-item mx-0 mx-lg-1">' +
    '<a class="nav-link py-3 px-0 px-lg-3 rounded " href="#students">Students</a>' +
   "</li>" +
  '<li class="nav-item mx-0 mx-lg-1">' +
  '<a class="nav-link py-3 px-0 px-lg-3 rounded " href="#highcharts">Highcharts</a>' +
  "  </li>" +
  '<li class="nav-item mx-0 mx-lg-1">' +
  '<a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#datatable">Datatable</a>' +
  "</li>" +
  '<li class="nav-item mx-0 mx-lg-1">' +
  '<a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#ex1">Example 1</a>' +
  "</li>" +
  '<li class="nav-item mx-0 mx-lg-1">' +
  '<a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#ex2">Example 2</a>' +
  "</li>" +
  '<li class="nav-item mx-0 mx-lg-1">' +
  '<a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#form">Form</a>' +
  "</li>";
$("#tabs").html(nav);

var main =
 '<section id="students">Highcharts</section>' +
  '<section id="highcharts">Highcharts</section>' +
  '<section id="datatable"><h1>Datatable</h1></section>' +
  '<section id="ex1"><h1>Example 1</h1></section>' +
  '<section id="ex2"><h1>Example 2</h1></section>' +
  '<section id="form"><h1>Form</h1></section>';
  $("#spapp").html(main);


  //Ajax request to get all students from DB, ovo je kao postman ali preko frontenda
  //console.log(REST_URL) //ovo je samo provejra da li radi
  //console.log(REST_URL + 'students');
  getAllStudents()
  //ovdje sad implementujem ove funkcije sto sam gore pisala

  function getAllStudent(){
    $.get(REST_URL + 'students', + function(data){
    var html = ' ';
    for(var i =0; i <data.length; i++){
      html += '<tr>' + '<td>' + data[0].first_name+'</td>'+
                      '<td>' + data[0].last_name+'</td>'+ 
                      '<td>< button class="btn btn-info" onClick="editStuden('+data[i].id+')">Edit Student</button></td>'+ 
                      '<td>< button class="btn btn-danger" onClick = "openConfirmationDialog('+data[i].id+')">Delete Student</button></td>'+ 
                      '</tr>';
//ovo plus data[i].id+ se odnosi na ono gdje smo u ROUTES pozivali update i delete functions i onda nam je trebalo po id da s eto radi
    } 
    $("#students").html(html);

    //console.log(data); ovo je da se isprintaju svi odjednom
  });

};


  //ovi dialogs su modal - bootstrap component, zalijepi se u html, ali se ne vidi dok se ne pozve
  function openConfirmationDialog(id){
    $("#deleteStudentModal").modal('show');
    $("#delete-student-body").html("Do you want to delete student with ID = " +id);
    $("#student_id").val(id);//ovo ima veze sa onim hidden inputom u modalu

  }


  function editStudent(id){

  }

  //preko ajaxa frontend komunicara sa backendom
  function deleteStudent(){

    
    //rest/students/1/test  ovako izgleda link kad radimo uobicajeno  
    //ili u queriju je rest/students?id=1&first_name = test, a ovako izgleda kad radimo preko querija
    $.ajax({
      'url': 'rest/students/' + $("#student_id").val(),  //ovdje se ne pise samo id, vec se uzima preko ove funkcije iznad id od osobe koja je kliknuta na frontendu
      'type' : 'DELETE',
      //'data' : {first_name: ' ', id: ' '}, ovo bi nam trebalo da radimo POST metodu
      success : function(response){ //ovo success ne ide pod navodne znake jer je naziv operacije, i ovdje je ona odmah definisana 
        console.log(response);
        $("#deleteStudentModal").modal('hide'); //ovo znaci kad se user obrise, onda makni ovaj dialog da ga ne gledamo
        toastr.success(response.message); //toaster ima biblioteku svoju za CSS i JS i on se koristi za one pop up messages, zelene, crvene u cosku kao confirmacija za nesto, ili tipa kad je pogresna sifra itd  itd
        getStudents(); //ovo ce nakon sto obirsmeo jesnog studenta, reload the page i sad ce biti ostatak tabele bez obrisanog studenta
        //alert('deleted')
      },
      error:function(XMLHttpRequest, textStatus, errorThrow){
        console.log("Error " + errorThrow);
      }

      }
    )
  }



  
  </script>

  </body>
  </html>




